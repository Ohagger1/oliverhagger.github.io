---
layout: archive
title: "3D MAP"
permalink: /3dmap/
author_profile: true
---


<!DOCTYPE html>
<html lang="en">
<head>
    <title>3D Building Viewer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
        #upload-form {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1;
        }
    </style>
</head>
<body>
  <form id="upload-form" enctype="multipart/form-data">
    <input type="file" id="file-input" name="file" accept=".stl" multiple>
    <button type="submit">Upload</button>
  </form>

  <script src="/assets/js/three.min.js"></script>
  <script src="/assets/js/STLLoader.min.js"></script>
  <script>
    // Set up Three.js components
    // Set up Three.js components
  const scene = new THREE.Scene();

  // Adjust the camera settings
  const fov = 45; // Field of view in degrees
  const aspect = window.innerWidth / window.innerHeight; // Aspect ratio
  const near = 0.1; // Near clipping plane
  const far = 100; // Far clipping plane
  const camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
  camera.position.z = 20; // Adjust the distance from the scene

  // Adjust the renderer size
  const rendererWidth = window.innerWidth * 0.8; // Set the width of the renderer to 80% of window width
  const rendererHeight = window.innerHeight * 0.6; // Set the height of the renderer to 60% of window height
  const renderer = new THREE.WebGLRenderer();
  renderer.setSize(rendererWidth, rendererHeight);
  document.body.appendChild(renderer.domElement);

  // Resize renderer on window resize
  window.addEventListener('resize', () => {
    const width = window.innerWidth * 0.8;
    const height = window.innerHeight * 0.6;
    renderer.setSize(width, height);
    camera.aspect = width / height;
    camera.updateProjectionMatrix();
  });

    // Set initial camera position
    camera.position.z = 5;

    // Function to render uploaded models
    function renderUploadedModels(data) {
        for (const fileName of data.files) {
            const loader = new THREE.STLLoader();
            loader.load(`/uploads/${fileName}`, function (geometry) {
                const material = new THREE.MeshPhongMaterial({ color: 0xaaaaaa });
                const mesh = new THREE.Mesh(geometry, material);
                scene.add(mesh);
            });
        }
    }

    // Handle file upload form submission
    document.getElementById('upload-form').addEventListener('submit', async function(event) {
        event.preventDefault();
        const files = document.getElementById('file-input').files;
        const formData = new FormData();
        for (const file of files) {
            formData.append('files', file);
        }
        try {
            const response = await fetch('/uploads', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            // Trigger function to render uploaded model(s) in the viewer
            renderUploadedModels(data);
        } catch (error) {
            console.error('Error uploading files:', error);
        }
    });

    // Animation loop
    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
    animate();
</script>

</body>
</html>
